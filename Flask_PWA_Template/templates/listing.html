{% extends 'layout.html' %} {% block content %}

<div class="hero-info">
  <h1>{{ listing.Title or listing.Title }}</h1>
  
    {% if average_rating is not none %}
    <div class="rating-circles">
    {% for i in range(1, 6) %}
      {% if average_rating >= i %}
        <div class="circle full"></div>
      {% elif average_rating + 0.5 >= i %}
        <div class="circle half"></div>
      {% else %}
        <div class="circle empty"></div>
      {% endif %}
    {% endfor %}
    <span class="rating-text">{{ average_rating | round(1) }}/5</span>
    <span class="rating-text">({{ rating_count }} reviews)</span>
    {% endif %}
  </div>

  <p class="location">{{ listing.Location }}</p>
  <p class="price">${{ listing.Price }}</p>
  <p class="opening-hours">Opening Hours: {{ listing.Opening_Hours }}</p>
  <p class="description">{{ listing.Description }}</p>
</div>
<div class="gallery">
  {% for url in images %}
  <div class="gallery-item">
    <img src="{{ url }}" alt="Photo of {{ listing.Title }} #{{ loop.index }}" />
  </div>
  {% endfor %}
</div>

<div class="listing-post-section">
<div class="post-container">
  {# listing.html, inside hero-info or near posts #}
  <div>
    <a class="btn btn-primary" href="{{ url_for('add_review', listing_id=listing['Listings_ID'])}}">
      Write a review
    </a>
  </div>

  {% for row in posts %}
    <div class="post-card">
      <div class="rating">
      {% for i in range(1, 6) %}
          {% if i <= row['Post_Rating'] %}
            <span class="rating-circle filled"></span>
          {% else %}
            <span class="rating-circle"></span>
          {% endif %}
        {% endfor %}
      </div>
      <p class="post-card-username">{{ row[''] }}</p>
      <p class="post-card-date">{{ row['Date'] }}</p>
      <p class="post-card-text">{{ row['Text'] }}</p>
    </div>
  {% endfor %}
</div>
<div id="map" class="map-container"></div>
<script>
  var map = L.map('map').setView([{{ listing.Latitude }}, {{ listing.Longitude }}], 15);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);
  L.marker([{{ listing.Latitude }}, {{ listing.Longitude }}]).addTo(map)
    .bindPopup('{{ listing.Title }}');
</script>
</div>

{% endblock %}
