{% extends 'layout.html' %}
{% block content %}
<div class="review-page" style="max-width:800px;margin:2rem auto;">
  <h2>Write a review for "{{ listing['Title'] if listing is mapping else listing.Title }}"</h2>

  {% if not current_user.is_authenticated %}
    <p>You must <a href="{{ url_for('log_in') }}">log in</a> to post a review.</p>
  {% endif %}

  <form method="POST" action="{{ url_for('review', listing_id=listing['Listings_ID'] if listing is mapping else listing.Listings_ID) }}">
    <div class="form-group">
      <label for="rating" class="form-label">Your Rating</label>
      <div class="rating" id="rating-circles">
        <span class="circle" data-value="1" title="1 Star"></span>
        <span class="circle" data-value="2" title="2 Stars"></span>
        <span class="circle" data-value="3" title="3 Stars"></span>
        <span class="circle" data-value="4" title="4 Stars"></span>
        <span class="circle" data-value="5" title="5 Stars"></span>
      </div>
      <input type="hidden" name="rating" id="rating-value" value="0" />
    </div>

    <div class="form-group">
      <label for="comment" class="form-label">Your Review</label>
      <textarea id="comment" name="comment" rows="6" required placeholder="Share your experience..."></textarea>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn-primary">Submit Review</button>
      <a class="btn-secondary" href="{{ url_for('listing_detail', listing_id=listing['Listings_ID'] if listing is mapping else listing.Listings_ID) }}">Cancel</a>
    </div>
  </form>

  <script>
    const circles = document.querySelectorAll('#rating-circles .circle:not(.disabled)');
    const ratingInput = document.getElementById('rating-value');

    circles.forEach(circle => {
      circle.addEventListener('click', () => {
        const value = parseInt(circle.dataset.value);
        ratingInput.value = value;

        circles.forEach(c => {
          c.classList.toggle('full', parseInt(c.dataset.value) <= value);
          c.classList.toggle('empty', parseInt(c.dataset.value) > value);
        });
      });
    });
  </script>
</div>
{% endblock %}
